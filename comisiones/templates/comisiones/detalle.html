{% extends 'base_listar.html' %}
{% load humanize %}
{% block title %}Detalle de Comisiones{% endblock %}

{% block title_filters %}
  <!-- CARD SUPERIOR -->
  <div class="card-top">
    <h1>Comisiones {{ comisionista }}</h1>
    <h2 style="text-align:center;">{{ mes_nombre }} / {{ anio }}</h2>

    <div class="pendiente-box">
      <h2>Pendiente por Pagar</h2>
      <p class="monto">${{ pendiente_pagar|floatformat:2|intcomma }}</p>
    </div>

    <!-- Botón Registrar Pago (ocupa todo el ancho) -->
    <div class="actions" style="width:100%; justify-content:center;">
      <a href="{% url 'registrar_pago' comisionista %}?next={{ next|urlencode }}&mes={{ mes }}&anio={{ anio }}" 
         class="btn filtro_pagado" 
         style="border-radius:12px; color:#fff; width:100%;">
         Registrar Pago
      </a>
    </div>
  </div>
{% endblock %}

{% block content %}
  <!-- CARD PRINCIPAL -->
  <div class="card">
    <div style="display:flex; gap:20px; flex-wrap:wrap; justify-content:center;">

      <!-- 🟡 Tabla Comisiones -->
      <div style="flex:1; min-width:400px; max-width:550px;">
        <h2 style="text-align:center;">Comisiones</h2>
        <div class="table-container">
          <table>
            <tr>
              <th>Cliente</th>
              <th>Monto Comisión</th>
              <th>Fecha Dispersión</th>
              <th>Estatus</th>
            </tr>
            {% for d in detalle %}
            <tr>
              <td>{{ d.cliente.nombre }}</td>
              <td>${{ d.monto|floatformat:2|intcomma }}</td>
              <td>{{ d.dispersion.fecha|date:"d/m/Y" }}</td>
              <td>{{ d.estatus }}</td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="4" style="text-align:center;">No hay comisiones registradas.</td>
            </tr>
            {% endfor %}
          </table>
        </div>
      </div>

      <!-- 🟢 Tabla Abonos / Pagos -->
      <div style="flex:1; min-width:400px; max-width:550px;">
        <h2 style="text-align:center;">Abonos / Pagos</h2>
        <div class="table-container">
          <table>
            <tr>
              <th>Fecha Pago</th>
              <th>Monto</th>
              <th>Acción</th>
            </tr>
            {% for a in abonos %}
            <tr>
              <td>{{ a.fecha_pago|date:"d/m/Y" }}</td>
              <td>${{ a.monto|floatformat:2|intcomma }}</td>
              <td>
                <a href="{% url 'editar_pago' comisionista a.id %}?next={{ next|urlencode }}&mes={{ mes }}&anio={{ anio }}" class="editar">Editar</a>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="3" style="text-align:center;">No hay abonos registrados.</td>
            </tr>
            {% endfor %}
          </table>
        </div>
      </div>
    </div>

    <!-- Botón Volver (pegado a la tabla) -->
    <div style="margin-top:.5rem; text-align:center;">
      <a href="{% url 'comisiones_listar' %}?mes={{ mes }}&anio={{ anio }}" class="btn filtro_pagado">Volver</a>
    </div>
  </div>
{% endblock %}
